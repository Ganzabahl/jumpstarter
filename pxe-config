etcd:
  version: 3.1.6
  name: "etcdserver"
  # generate a new token for each unique cluster from https://discovery.etcd.io/new?size=3
  # specify the initial size of your cluster with ?size=X
  discovery: https://discovery.etcd.io/7a25a3b8c8d407a8ee399ef05625688e
  # multi_region and multi_cloud deployments need to use {PUBLIC_IPV4}
  advertise_client_urls: http://192.168.1.133:2379,http://192.168.1.133:4001
  initial_advertise_peer_urls: http://192.168.1.133:2380
  # listen on both the official ports and the legacy ports
  # legacy ports can be omitted if your application doesn't depend on them
  listen_client_urls: http://0.0.0.0:2379,http://0.0.0.0:4001
  listen_peer_urls: http://192.168.1.133:2380
systemd:
  units:
    - name: etcd-member.service
      enable: true
      dropins:
        - name: conf1.conf
          contents: |
            [Service]
            Environment="ETCD_NAME=etcdserver"
    - name: getty@.service
      dropins:
        - name: no-disallocate.conf
          contents: |
            [Service]
            TTYVTDisallocate=no
systemd:
  units:
    - name: docker-tcp.socket
      enable: yes
      mask: false
      contents: |
        [Unit]
        Description=Docker Socket for the API

        [Socket]
        ListenStream=2375
        BindIPv6Only=both
        Service=docker.service

        [Install]
        WantedBy=sockets.target
    - name: enable-docker-tcp.service
      enable: true
      contents: |
        [Unit]
        Description=Enable the Docker Socket for the API

        [Service]
        Type=oneshot
        ExecStart=/usr/bin/systemctl enable docker-tcp.socket

storage:
  files:
    - path: /etc/ssh/sshd_config
      filesystem: root
      mode: 0600
      contents:
        inline: |
          # Use most defaults for sshd configuration.
          UsePrivilegeSeparation sandbox
          Subsystem sftp internal-sftp
          UseDNS no

          PermitRootLogin no
          AllowUsers core
          AuthenticationMethods publickey
    - path: /etc/modules-load.d/br_netfilter.conf
      filesystem: root
      mode: 0644
      contents:
        inline: |
          br_netfilter
    - path: /etc/modules-load.d/nf.conf
      filesystem: root
      mode: 0644
      contents:
        inline: |
          nf_conntrack
    - path: /etc/sysctl.d/nf.conf
      filesystem: root
      mode: 0644
      contents:
        inline: |
          net.netfilter.nf_conntrack_max=131072
    - path: /etc/ssh/ssh_host_dsa_key
      filesystem: root
      contents:
        remote:
          url: http://192.168.1.2/ssh/ssh_host_dsa_key
      mode: 0644
    - path: /etc/ssh/ssh_host_dsa_key.pub
      filesystem: root
      contents:
        remote:
          url: http://192.168.1.2/ssh/ssh_host_dsa_key.pub
      mode: 0644
    - path: /etc/ssh/ssh_host_ecdsa_key
      filesystem: root
      contents:
        remote:
          url: http://192.168.1.2/ssh/ssh_host_ecdsa_key
      mode: 0600
    - path: /etc/ssh/ssh_host_ecdsa_key.pub
      filesystem: root
      contents:
        remote:
          url: http://192.168.1.2/ssh/ssh_host_ecdsa_key.pub
      mode: 0644
    - path: /etc/ssh/ssh_host_ed25519_key
      filesystem: root
      contents:
        remote:
          url: http://192.168.1.2/ssh/ssh_host_ed25519_key
      mode: 0600
    - path: /etc/ssh/ssh_host_ed25519_key.pub
      filesystem: root
      contents:
        remote:
          url: http://192.168.1.2/ssh/ssh_host_ed25519_key.pub
      mode: 0644
    - path: /etc/ssh/ssh_host_rsa_key
      filesystem: root
      contents:
        remote:
          url: http://192.168.1.2/ssh/ssh_host_rsa_key
      mode: 0600
    - path: /etc/ssh/ssh_host_rsa_key.pub
      filesystem: root
      contents:
        remote:
          url: http://192.168.1.2/ssh/ssh_host_rsa_key.pub
      mode: 0644

passwd:
  users:
    - name: core
      ssh_authorized_keys:
        - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCrJDQj7oJfu0Tv7BJI2es8YVaugLaOEGdrBq2UJi6vPFdj7gYEHw40HM+OEB3qekzNZ9+PJ2XbGxkcHkq00PN1QL4Hl9qyxWJ+o3On627IZd7bu0mJdDWDRMpPrnBVFrg5dNGYd2V6LUDd+rosoNmTYfLW6u9WJWViU5px1jXJ9om0cOeiC5BCSGBZqeATZoZ7O+68yxAJYwJJARz5YSqZLt5sXipnuU7KnSXD15+CprGByK8oXtQ9I+xvPopg4XJdERCTHbuhQRWVv9HqJMAKjAaAKdlLuMU4cMbnVFfuz6xlYFzhv+Sje1Q6zsHdI2ADVtKtoNYSiicLMHjR6nY5
